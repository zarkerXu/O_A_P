<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.oa.mapper.OrganizationMapper" >
<resultMap id="Organization" type="cn.com.oa.model.Organization">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:57 CST 2015.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="typeid" jdbcType="VARCHAR" property="typeid" />
    <result column="pid" jdbcType="VARCHAR" property="pid" />
    <result column="sort" jdbcType="INTEGER" property="sort" />
    <result column="level" jdbcType="INTEGER" property="level" />
    <result column="contact1" jdbcType="VARCHAR" property="contact1" />
    <result column="contact2" jdbcType="VARCHAR" property="contact2" />
    <result column="contact3" jdbcType="VARCHAR" property="contact3" />
    <result column="isdef" jdbcType="INTEGER" property="isdef" />
    <result column="isuse" jdbcType="INTEGER" property="isuse" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="cuid" jdbcType="VARCHAR" property="cuid" />
    <result column="createTime" jdbcType="TIMESTAMP" property="createTime" />
    <result column="uuid" jdbcType="VARCHAR" property="uuid" />
    <result column="updataTime" jdbcType="TIMESTAMP" property="updataTime" />
    
    
  </resultMap>
<!--  删除记录  -->  
    <delete id="delete" parameterType="String">
       delete from sys_organization where id = #{id}
    </delete>  
    <select id="select" parameterType="String" resultType="Organization">
    select * from sys_organization where id=#{id} 
    </select>
    <select id="findFirstOrganize" resultType="Organization">
    select * from sys_organization where level=0 and isdef=1 and isuse=0;
    </select>
    <select id="findallChildOrganize" parameterType="String" resultType="Organization">
     <![CDATA[ 
       select * from sys_organization where FIND_IN_SET(id,queryOrganizationChildrenInfo(#{pid})) and id <> #{pid}
    ]]>  
    </select>
    <select id="findByParameter" parameterType="Organization" resultType="Organization">
    select o.* ,(select name from sys_organization_type t where t.id=o.typeid) as typeName ,t.sort 
    from sys_organization o
    left join sys_organization_type t on o.typeid=t.id
    <where>
    o.isuse=0
    <if test="id!=null and id!=''">
    and o.id=#{id}
    </if>
    <if test="name !=null and name !=''">
    and o.name=#{name}
    </if>
    <if test="typeid !=null and typeid !=''">
    and o.typeid=#{typeid}
    </if>
    <if test="pid !=null and pid !=''">
    and o.pid=#{pid}
    </if>
    <if test="sort !=null">
    and o.sort=#{sort}
    </if>
    <if test="level !=null">
    and o.level=#{level}
    </if>
    <if test="contact1 !=null and contact1 !=''">
    and o.contact1=#{contact1}
    </if>
    <if test="contact2 !=null and contact2 !=''">
    and contact2=#{contact2}
    </if>
    <if test="contact3 !=null and contact3 !=''">
    and contact3=#{contact3}
    </if>
    <if test="isdef !=null">
    and o.isdef=#{isdef}
    </if>
    <if test="isuse !=null">
    and o.isuse=#{isuse}
    </if>
    <if test="remark !=null and remark !=''">
    and o.remark=#{remark}
    </if>
    <if test="cuid !=null and cuid !=''">
    and o.cuid=#{cuid}
    </if>
    <if test="createTime !=null and createTime !=''">
    and o.createTime=#{createTime}
    </if>
    <if test="uuid !=null and uuid !=''">
    and o.uuid=#{uuid}
    </if>
    <if test="updataTime !=null and updataTime !=''">
    and o.updataTime=#{updataTime}
    </if>
    </where>
    order by t.sort,o.sort
  
    </select>
    
    <select id="finddepartmentnames" parameterType="String" resultType="String">
             select name from sys_organization where id in ( ${value})
    </select>
    <select id="findiddepartmentname" parameterType="String" resultType="String">
             select name from sys_organization where id=(select oid from sys_user where id=#{value})
    </select>
    
    <select id="findParentById" parameterType="String" resultType="Organization">
    select * from sys_organization where FIND_IN_SET(id,queryOrganizationParentInfo(#{id}))>0 
    </select>
    <update id="update" parameterType="Organization" >
    update sys_organization 
    <set>
    <if test="name !=null and name !=''">
    name=#{name},
    </if>
    <if test="typeid !=null and typeid !=''">
     typeid=#{typeid},
    </if>
    <if test="pid !=null and pid !=''">
     pid=#{pid},
    </if>
    <if test="sort !=null">
     sort=#{sort},
    </if>
    <if test="level !=null">
     level=#{level},
    </if>
    <if test="contact1 !=null and contact1 !=''">
     contact1=#{contact1},
    </if>
    <if test="contact2 !=null and contact2 !=''">
     contact2=#{contact2},
    </if>
    <if test="contact3 !=null and contact3 !=''">
     contact3=#{contact3},
    </if>
    <if test="isuse !=null">
     isuse=#{isuse},
    </if>
    <if test="remark !=null and remark !=''">
     remark=#{remark},
    </if>
    <if test="cuid !=null and cuid !=''">
     cuid=#{cuid},
    </if>
    <if test="createTime !=null and createTime !=''">
     createTime=#{createTime},
    </if>
    <if test="uuid !=null and uuid !=''">
     uuid=#{uuid},
    </if>
    <if test="updataTime !=null and updataTime !=''">
     updataTime=#{updataTime}
    </if>
    </set>
     where id=#{id}
     </update>
    <insert id="insert" parameterType="Organization">
      insert into sys_organization(id,name,typeid,pid,sort,level,contact1,contact2,contact3,isdef,isuse,remark,cuid,createTime) values(#{id},#{name,jdbcType=VARCHAR},#{typeid,jdbcType=VARCHAR},#{pid,jdbcType=VARCHAR},#{sort,jdbcType=INTEGER},#{level,jdbcType=INTEGER},#{contact1,jdbcType=VARCHAR},#{contact2,jdbcType=VARCHAR},#{contact3,jdbcType=VARCHAR},1,0,#{remark,jdbcType=VARCHAR},#{cuid},#{createTime})
    </insert>
    <update id="del" parameterType="String" >
    update sys_organization set isuse=1 where FIND_IN_SET(id,queryOrganizationChildrenInfo(#{id}))
    </update>
    <update id="deluser" parameterType="String" >
    update sys_user set isuse=1 where FIND_IN_SET(oid,queryOrganizationChildrenInfo(#{id}))
    </update>
    
    
</mapper>