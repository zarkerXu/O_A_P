<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.oa.mapper.MEntryMapper" >
<resultMap id="MEntry" type="cn.com.oa.model.MEntry">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:57 CST 2015.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
     <result column="pid" jdbcType="VARCHAR" property="pid" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="post" jdbcType="VARCHAR" property="post" />
    <result column="sex" jdbcType="INTEGER" property="sex" />
    <result column="phone" jdbcType="VARCHAR" property="phone" />
    <result column="type" jdbcType="INTEGER" property="type" />
    
    
  </resultMap>
<!--  删除记录  -->  
    <delete id="delete" parameterType="String">
       delete from m_entry where id = #{id}
    </delete>  
    <delete id="deleteByTaskid" parameterType="String">
       delete from m_entry where pid = #{id}
    </delete>  
     <select id="select" parameterType="String" resultType="MEntry">
    select * from m_entry where id=#{id}
    </select>
    <select id="findByParameter" parameterType="MEntry" resultType="MEntry">
    select * from m_entry
    <where>
    <if test="pid !=null and pid !=''">
    and pid=#{pid}
    </if>
    <if test="name !=null and name !=''">
    and name=#{name}
    </if>
    <if test="post !=null and post !=''">
    and post=#{post}
    </if>
    <if test="phone !=null and phone !=''">
    and phone=#{phone}
    </if>
    <if test="sex !=null">
    and sex=#{sex}
    </if>
    <if test="type !=null">
    and type=#{type}
    </if>
    </where>
     <if test="orderBy !=null and orderBy !=''">
    order by ${orderBy}
    </if>
    </select>
    <select id="findByMeetid" parameterType="MEntry" resultType="MEntry">
    select m.*,
(select GROUP_CONCAT(name ORDER BY level) from sys_organization where FIND_IN_SET(id,queryOrganizationParentInfo((select oid from  d_task where id=m.pid)))) as organame 
	
from m_entry m  LEFT JOIN sys_organization o ON o.id=(select oid from  d_task where id=m.pid) 
   
LEFT JOIN sys_organization_type p ON p.id=o.typeid 
    <where>
    m.pid in (select id from d_task where did=#{id})
    <if test="name !=null and name !=''">
    and name=#{name}
    </if>
    <if test="post !=null and post !=''">
    and post=#{post}
    </if>
    <if test="phone !=null and phone !=''">
    and phone=#{phone}
    </if>
    <if test="sex !=null">
    and sex=#{sex}
    </if>
    <if test="type !=null">
    and type=#{type}
    </if>
    </where> 
    order by m.type,queryOrganizationParentInfo((select oid from  d_task where id=m.pid)), m.passStatus desc,p.sort,o.sort
    </select>
    <update id="update"  parameterType="MEntry">
    update m_entry
    <set>
     <if test="name !=null and name !=''">
    name=#{name},
    </if>
    <if test="post !=null and post !=''">
    post=#{post},
    </if>
    <if test="phone !=null and phone !=''">
    phone=#{phone},
    </if>
    <if test="sex !=null">
    sex=#{sex},
    </if>
    <if test="type !=null">
    type=#{type},
    </if>
    <if test="passStatus !=null">
    passStatus=#{passStatus},
    </if>
    <if test="remark !=null and remark !=''">
    remark=#{remark},
    </if>
    <if test="passRemark !=null and passRemark !=''">
    passRemark=#{passRemark}
    </if>
    </set>
    where id=#{id}
    </update>
   <insert id="insertList" parameterType="java.util.List">  
    insert into m_entry (id,pid,name,post,sex,phone,type,passStatus,remark,passRemark)   
    values  
    <foreach collection="list" item="item" index="index" separator="," >  
        (#{item.id},#{item.pid},#{item.name,jdbcType=VARCHAR},#{item.post,jdbcType=VARCHAR},#{item.sex,jdbcType=VARCHAR},#{item.phone,jdbcType=VARCHAR},#{item.type},3,#{item.remark,jdbcType=VARCHAR},#{item.passRemark,jdbcType=VARCHAR})
    </foreach>  
    </insert>  
    <insert id="insert" parameterType="MEntry">
      insert into m_entry(id,pid,name,post,sex,phone,type,passStatus,remark,passRemark) values(#{id},#{pid},#{name,jdbcType=VARCHAR},#{post,jdbcType=VARCHAR},#{sex,jdbcType=VARCHAR},#{phone,jdbcType=VARCHAR},#{type},3,#{remark,jdbcType=VARCHAR},#{passRemark,jdbcType=VARCHAR})
    </insert>
</mapper>