<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.oa.mapper.MeetMapper">
	<resultMap id="Meet" type="cn.com.oa.model.Meet">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Nov 20 
			17:32:57 CST 2015. -->
		<id column="id" jdbcType="VARCHAR" property="id" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="meetTime" jdbcType="TIMESTAMP" property="meetTime" />
		<result column="meetCompany" jdbcType="VARCHAR" property="meetCompany" />
		<result column="department" jdbcType="VARCHAR" property="department" />
		<result column="level" jdbcType="INTEGER" property="level" />
		<result column="docNo" jdbcType="VARCHAR" property="docNo" />
		<result column="docTitle" jdbcType="VARCHAR" property="docTitle" />
		<result column="docSummary" jdbcType="VARCHAR" property="docSummary" />
		<result column="contactName" jdbcType="VARCHAR" property="contactName" />
		<result column="contactPhone" jdbcType="VARCHAR" property="contactPhone" />
		<result column="addr" jdbcType="VARCHAR" property="addr" />
		<result column="signNum" jdbcType="INTEGER" property="signNum" />
		<result column="signStatus" jdbcType="INTEGER" property="signStatus" />
		<result column="passStatus" jdbcType="INTEGER" property="passStatus" />
		<result column="isuse" jdbcType="INTEGER" property="isuse" />
		<result column="remark" jdbcType="VARCHAR" property="remark" />
		<result column="cuid" jdbcType="VARCHAR" property="cuid" />
		<result column="createTime" jdbcType="TIMESTAMP" property="createTime" />
		<result column="uuid" jdbcType="VARCHAR" property="uuid" />
		<result column="updataTime" jdbcType="TIMESTAMP" property="updataTime" />
		<result column="oldid" jdbcType="VARCHAR" property="oldid" />
		<result column="relayRemark" jdbcType="VARCHAR" property="relayRemark"/>

	</resultMap>
	<!-- 删除记录 -->
	<delete id="delete" parameterType="String">
		delete from meet where id in
		(${value})
	</delete>
	<delete id="deleteupdate" parameterType="String">
	    update meet set isuse=1 where id in (${value})
	</delete>
	<update id="update" parameterType="Meet">
		update meet
		<set>
			<if test="signStatus !=null">
				signStatus=#{signStatus},
			</if>
			<if test="passStatus !=null">
				passStatus=#{passStatus},
			</if>
			<if test="isuse !=null">
				isuse=#{isuse},
			</if>
			<if test="remark !=null and remark !=''">
				remark=#{remark},
			</if>
			<if test="uuid !=null and uuid !=''">
				uuid=#{uuid},
			</if>
			<if test="updataTime !=null and updataTime !=''">
				updataTime=#{updataTime}
			</if>
		</set>
		where id=#{id}
	</update>

	<select id="select" parameterType="String" resultType="Meet">
		select
		m.*,(select o.name from sys_organization o join sys_user u on
		u.oid=o.id where u.id=m.cuid) as sendDepartmentInfo,(select o.name
		from sys_organization o where o.id=m.meetCompany) as
		meetCompanyName,(select group_concat(name) from sys_organization o
		where FIND_IN_SET( o.id, m.department)) as departmentInfo from meet m
		where id=#{id}
	</select>

	<select id="findByParameter" parameterType="Meet" resultType="Meet">
		select * from meet
		<where>
			isuse=0
			<if test="level !=null">
				and level=#{level}
			</if>
			<if test="docNo !=null and docNo !=''">
				and docNo=#{docNo}
			</if>
			<if test="docTitle !=null and docTitle !=''">
				and docTitle=#{docTitle}
			</if>
			<if test="docSummary !=null and docSummary !=''">
				docSummary=#{docSummary},
			</if>
			<if test="name !=null and name !=''">
				and name=#{name}
			</if>
			<if test="meetTime !=null and meetTime !=''">
				and meetTime=#{meetTime}
			</if>
			<if test="meetCompany !=null and meetCompany !=''">
				and meetCompany=#{meetCompany}
			</if>
			<if test="passStatus !=null and passStatus !=''">
				and passStatus=#{passStatus}
			</if>
			<if test="signNum !=null">
				and signNum=#{signNum}
			</if>
			<if test="signStatus !=null">
				and signStatus=#{signStatus}
			</if>
			<if test="remark !=null and remark !=''">
				and remark=#{remark}
			</if>
			<if test="cuid !=null and cuid !=''">
				and cuid=#{cuid}
			</if>
			<if test="createTime !=null and createTime !=''">
				and createTime=#{createTime}
			</if>
			<if test="uuid !=null and uuid !=''">
				and uuid=#{uuid}
			</if>
			<if test="updataTime !=null and updataTime !=''">
				and updataTime=#{updataTime}
			</if>
		</where>
		<if test="orderBy !=null and orderBy !=''">
			order by ${orderBy}
		</if>
	</select>


	<select id="findByParameterToPage" parameterType="Page"
		resultType="Meet">  <!--parameterType:传进去的type,resultType:传出来的type -->
		select *,(select o.name from sys_organization o join sys_user u on
		u.oid=o.id where u.id=d.cuid) as sendDepartmentInfo,(select
		group_concat(name) from sys_organization where FIND_IN_SET( id,
		d.department)) as departmentInfo
		,if(signStatus=0,signNum,(select
		count(*) from d_task t where t.did=d.id and t.type=1 and
		t.signStatus=0)) as didtask,(select o.name from sys_organization o
		where o.id=d.meetCompany) as meetCompanyName from meet d
		<where>
			isuse=0 and d.oldid is null
			<if test="pageObject.id!=null and pageObject.id!=''">
				and id=#{pageObject.id}
			</if>
			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''">
				and name like #{pageObject.name}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary like #{pageObject.docSummary}
			</if>
			<if test="pageObject.meetCompany !=null and pageObject.meetCompany !=''">
				and meetCompany = #{pageObject.meetCompany}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="pageObject.remark !=null and pageObject.remark !=''">
				and remark=#{pageObject.remark}
			</if>
			<if test="pageObject.cuid !=null and pageObject.cuid !=''">
				and cuid=#{pageObject.cuid}
			</if>
			<if test="pageObject.uuid !=null and pageObject.uuid !=''">
				and uuid=#{pageObject.uuid}
			</if>
			<if test="startTime !=null and startTime !=''">
				and d.createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and d.createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="userids !=null and userids !=''">
				and cuid in (${userids})
			</if>
		</where>
		<if test="pageObject.orderBy !=null and pageObject.orderBy !=''">
			order by ${pageObject.orderBy}
		</if>
		limit #{Before},#{size}
	</select>
	<select id="findByParameterToPages" parameterType="Page"
		resultType="Integer">
		select count(*) from meet d
		<where>
			isuse=0 and d.oldid is null
			<if test="pageObject.id!=null and pageObject.id!=''">
				and id=#{pageObject.id}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''">
				and name like #{pageObject.name}
			</if>
			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.meetCompany !=null and pageObject.meetCompany !=''">
				and meetCompany = #{pageObject.meetCompany}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.remark !=null and pageObject.remark !=''">
				and remark=#{pageObject.remark}
			</if>
			<if test="pageObject.cuid !=null and pageObject.cuid !=''">
				and cuid=#{pageObject.cuid}
			</if>
			<if test="pageObject.uuid !=null and pageObject.uuid !=''">
				and uuid=#{pageObject.uuid}
			</if>
			<if test="startTime !=null and startTime !=''">
				and d.createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and d.createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="userids !=null and userids !=''">
				and cuid in (${userids})
			</if>
		</where>
	</select>
	<select id="findByTaskToPage" parameterType="Page" resultType="Meet">
		select t.id as
		tid,d.id,d.meetTime,d.name,d.level,d.docNo,d.docTitle,d.addr,d.docSummary,d.personnel,d.remark,d.createTime,t.signStatus,t.passStatus,(select
		o.name from sys_organization o join sys_user u on u.oid=o.id where
		u.id=d.cuid) as sendDepartmentInfo,(select o.name from
		sys_organization o where o.id=d.meetCompany) as meetCompanyName from
		d_task t join meet d on d.id=t.did
		<where>
			t.type=2
			and d.isuse=0
			and d.remark is null
			and (t.uid=#{userids} or
			(t.oid=(select oid from sys_user where
			id=#{userids}) and t.uid is
			null and t.signStatus=1 and 0=(select
			ismain from sys_user where
			id=#{userids})) )
			<if test="pageObject.id !=null and pageObject.id !=''">
				and d.id=#{pageObject.id}
			</if>
			<if test="pageObject.level !=null">
				and d.level=#{pageObject.level}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''">
				and d.name like #{pageObject.name}
			</if>
			<if test="pageObject.meetCompany !=null and pageObject.meetCompany !=''">
				and d.meetCompany = #{pageObject.meetCompany}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and d.docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and d.docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and d.docSummary like #{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and d.signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and d.signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.remark !=null and pageObject.remark !=''">
				and d.remark=#{pageObject.remark}
			</if>
			<if test="pageObject.cuid !=null and pageObject.cuid !=''">
				and d.cuid=#{pageObject.cuid}
			</if>
			<if test="pageObject.uuid !=null and pageObject.uuid !=''">
				and d.uuid=#{pageObject.uuid}
			</if>
			<if test="startTime !=null and startTime !=''">
				and d.meetTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and d.meetTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
		</where>
		order by t.signStatus desc,t.passStatus desc,d.createTime desc
		limit #{Before},#{size}
	</select>

	<select id="findByTaskToPageCount" parameterType="Page"
		resultType="Integer">
		select count(*) from d_task t join meet d on d.id=t.did
		<where>
			t.type=2
			and d.isuse=0
			and d.remark is null
			and (t.uid=#{userids} or
			(t.oid=(select oid from sys_user where
			id=#{userids}) and t.uid is
			null and t.signStatus=1 and 0=(select
			ismain from sys_user where
			id=#{userids})) )
			<if test="pageObject.id !=null and pageObject.id !=''">
				and d.id=#{pageObject.id}
			</if>
			<if test="pageObject.level !=null">
				and d.level=#{pageObject.level}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''">
				and d.name like #{pageObject.name}
			</if>
			<if test="pageObject.meetCompany !=null and pageObject.meetCompany !=''">
				and d.meetCompany = #{pageObject.meetCompany}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and d.docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and d.docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and d.docSummary like #{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and d.signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and d.signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.remark !=null and pageObject.remark !=''">
				and d.remark=#{pageObject.remark}
			</if>
			<if test="pageObject.cuid !=null and pageObject.cuid !=''">
				and d.cuid=#{pageObject.cuid}
			</if>
			<if test="pageObject.uuid !=null and pageObject.uuid !=''">
				and d.uuid=#{pageObject.uuid}
			</if>
			<if test="startTime !=null and startTime !=''">
				and d.meetTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and d.meetTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
		</where>
	</select>

	<select id="findByUserToPage" parameterType="Page" resultType="Meet">
		select *,(select o.name from sys_organization o join sys_user u on
		u.oid=o.id where u.id=d.cuid) as sendDepartmentInfo,(select
		group_concat(name) from sys_organization where FIND_IN_SET( id,
		d.department)) as departmentInfo
		,if(signStatus=0,signNum,(select
		count(*) from d_task t where t.did=d.id and t.type=2 and
		t.signStatus=0)) as didtask ,(select o.name from sys_organization o
		where o.id=d.meetCompany) as meetCompanyName from meet d
		<where>
			d.isuse=0
			and d.remark is null
			<if test="pageObject.id!=null and pageObject.id!=''">
				and id=#{pageObject.id}
			</if>
			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="pageObject.remark !=null and pageObject.remark !=''">
				and remark=#{pageObject.remark}
			</if>
			<if test="pageObject.cuid !=null and pageObject.cuid !=''">
				and cuid=#{pageObject.cuid}
			</if>
			<if test="pageObject.uuid !=null and pageObject.uuid !=''">
				and uuid=#{pageObject.uuid}
			</if>
			<if test="startTime !=null and startTime !=''">
				and d.createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and d.createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			and cuid =#{userids}
		</where>
		<if test="pageObject.orderBy !=null and pageObject.orderBy !=''">
			order by ${pageObject.orderBy}
		</if>
		limit #{Before},#{size}
	</select>
	<select id="findByUserToPageCount" parameterType="Page"
		resultType="Integer">
		select count(*) from meet d
		<where>
			d.isuse=0
			and d.remark is null
			<if test="pageObject.id!=null and pageObject.id!=''">
				and id=#{pageObject.id}
			</if>
			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="pageObject.remark !=null and pageObject.remark !=''">
				and remark=#{pageObject.remark}
			</if>
			<if test="pageObject.cuid !=null and pageObject.cuid !=''">
				and cuid=#{pageObject.cuid}
			</if>
			<if test="pageObject.uuid !=null and pageObject.uuid !=''">
				and uuid=#{pageObject.uuid}
			</if>
			<if test="startTime !=null and startTime !=''">
				and d.createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and d.createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			and cuid =#{userids}
		</where>
	</select>



	<select id="isSign" parameterType="String" resultType="Boolean">
		select
		if(signNum=(select count(*) from d_task where did=m.id and
		signStatus=0),true,false) as a from meet m where id=(select did from
		d_task where id=#{tid} and type=2)
	</select>
	
	
	<!-- DocMeet used -->
	<select id="mfindByRelayToPage" parameterType="Page" resultType="DocMeet">
		SELECT * from(
		SELECT
		d.id,d.department,d.personnel,d.level,d.docNo,d.docTitle,d.docSummary,d.signNum,d.signStatus,d.isuse
		,d.remark ,d.cuid ,d.createTime,d.oldid,d.relayRemark,
		(select o.name from
		sys_organization o join sys_user u on u.oid=o.id where
		u.id=d.cuid) as
		sendDepartmentInfo,
		(select count(*) from d_task t where t.did=d.id and
		t.type=1 and t.remark=0)
		as signUid,
		d.uuid as name,d.uuid as
		meetTime,d.uuid as meetCompany,1 as type,
		(select o.name from sys_organization o LEFT JOIN sys_user u on o.id=u.oid where u.id=(select cuid from doc where id=d.oldid))as oldSendDepartment 
		from doc d

		UNION ALL

		SELECT
		m.id,m.department,m.personnel,m.level,m.docNo,m.docTitle,m.docSummary,m.signNum,m.signStatus,m.isuse,m.remark,m.cuid
		,m.createTime,m.oldid,m.relayRemark,
		(select o.name from sys_organization o join
		sys_user u on u.oid=o.id where
		u.id=m.cuid) as sendDepartmentInfo,
		(select count(*) from d_task t where t.did=m.id and t.type=2 and
		t.remark=0)
		as signUid,
		m.name,m.meetTime,(select name from
		sys_organization o where o.id=m.meetCompany) as
		meetCompany,2 as type,
		(select o.name from sys_organization o LEFT JOIN sys_user u on o.id=u.oid where u.id=(select cuid from meet where id=m.oldid))as oldSendDepartment 
		from meet m
		) Tmp
		<where>
			cuid=#{pageObject.cuid}
			and remark =0
			and isuse=0

			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.name !=null and pageObject.name !='' and pageObject.type == 2">
				and name like #{pageObject.name}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="startTime !=null and startTime !=''">
				and createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
		</where>
		order by signStatus desc,createTime desc
		limit #{Before},#{size}
	</select>


	<select id="mfindByRelayToPageCount" parameterType="Page"
		resultType="Integer">
		SELECT count(*) from(
		SELECT
		d.id,d.department,d.personnel,d.level,d.docNo,d.docTitle,d.docSummary,d.signNum,d.signStatus,d.isuse
		,d.remark ,d.cuid ,d.createTime,d.oldid,
		(select o.name from
		sys_organization o join sys_user u on u.oid=o.id where
		u.id=d.cuid) as
		sendDepartmentInfo,
		(select count(*) from d_task t where t.did=d.id and
		t.type=1 and t.remark=0)
		as signUid,
		d.uuid as name,d.uuid as
		meetTime,d.uuid as meetCompany,1 as type
		from doc d

		UNION ALL

		SELECT
		m.id,m.department,m.personnel,m.level,m.docNo,m.docTitle,m.docSummary,m.signNum,m.signStatus,m.isuse,m.remark,m.cuid
		,m.createTime,m.oldid,
		(select o.name from sys_organization o join
		sys_user u on u.oid=o.id where
		u.id=m.cuid) as sendDepartmentInfo,
		(select count(*) from d_task t where t.did=m.id and t.type=2 and
		t.remark=0)
		as signUid,
		m.name,m.meetTime,(select name from
		sys_organization o where o.id=m.meetCompany) as
		meetCompany,2 as type
		from meet m
		) Tmp
		<where>
			cuid=#{pageObject.cuid}
			and remark =0
			and isuse=0

			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''  and pageObject.type == 2">
				and name like #{pageObject.name}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="startTime !=null and startTime !=''">
				and createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
		</where>
	</select>




	<select id="mfindByApproveToPage" parameterType="Page"
		resultType="DocMeet">
		SELECT * from(
		SELECT
		d.id,d.department,d.personnel,d.level,d.docNo,d.docTitle,d.docSummary,d.signNum,d.signStatus,d.isuse
		,d.remark ,d.cuid ,d.createTime,d.oldid,
		(select o.name from sys_organization o join sys_user u on u.oid=o.id where
		u.id=d.cuid) as sendDepartmentInfo,
		(select count(*) from d_task t where t.did=d.id and t.type=1 and t.remark=0)
		as signUid,
		d.uuid as name,d.uuid as meetTime,d.uuid as meetCompany,1 as type,
		t.id as tid,t.remark as isPass,d.relayRemark,
		(select o.name from sys_organization o LEFT JOIN sys_user u on o.id=u.oid where u.id=(select cuid from doc where id=d.oldid))as oldSendDepartment 
		from doc d left join d_task t on t.did=d.id and t.uid=#{pageObject.cuid}

		UNION ALL

		SELECT
		m.id,m.department,m.personnel,m.level,m.docNo,m.docTitle,m.docSummary,m.signNum,m.signStatus,m.isuse,m.remark
		,m.cuid ,m.createTime,m.oldid,
		(select o.name from sys_organization o join sys_user u on u.oid=o.id where
		u.id=m.cuid) as sendDepartmentInfo,
		(select count(*) from d_task t where t.did=m.id and t.type=2 and t.remark=0)
		as signUid,
		m.name,m.meetTime,(select name from sys_organization o where o.id=m.meetCompany) as
		meetCompany,2 as type,
		t.id as tid,t.remark as isPass,m.relayRemark,
		(select o.name from sys_organization o LEFT JOIN sys_user u on o.id=u.oid where u.id=(select cuid from meet where id=m.oldid))as oldSendDepartment 
		from meet m left join d_task t on t.did=m.id and t.uid=#{pageObject.cuid}
		) Tmp
		<where>
			remark =0
			and isuse=0
			and FIND_IN_SET(#{pageObject.cuid},personnel)

			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''  and pageObject.type == 2">
				and name like #{pageObject.name}
			</if>
			<if test="startTime !=null and startTime !=''">
				and createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
		</where>
		order by isPass desc,createTime desc
		limit #{Before},#{size}
	</select>
	
	<select id="mfindByApproveToPageCount" parameterType="Page"
		resultType="Integer">
		SELECT count(*) from(
		SELECT
		d.id,d.department,d.personnel,d.level,d.docNo,d.docTitle,d.docSummary,d.signNum,d.signStatus,d.isuse
		,d.remark ,d.cuid ,d.createTime,d.oldid,
		(select o.name from sys_organization o join sys_user u on u.oid=o.id where
		u.id=d.cuid) as sendDepartmentInfo,
		(select count(*) from d_task t where t.did=d.id and t.type=1 and t.remark=0)
		as signUid,
		d.uuid as name,d.uuid as meetTime,d.uuid as meetCompany,1 as type,
		t.id as tid,t.remark as isPass,d.relayRemark
		from doc d left join d_task t on t.did=d.id and t.uid=#{pageObject.cuid}

		UNION ALL

		SELECT
		m.id,m.department,m.personnel,m.level,m.docNo,m.docTitle,m.docSummary,m.signNum,m.signStatus,m.isuse,m.remark
		,m.cuid ,m.createTime,m.oldid,
		(select o.name from sys_organization o join sys_user u on u.oid=o.id where
		u.id=m.cuid) as sendDepartmentInfo,
		(select count(*) from d_task t where t.did=m.id and t.type=2 and t.remark=0)
		as signUid,
		m.name,m.meetTime,(select name from sys_organization o where o.id=m.meetCompany) as
		meetCompany,2 as type,
		t.id as tid,t.remark as isPass,m.relayRemark
		from meet m left join d_task t on t.did=m.id and t.uid=#{pageObject.cuid}
		) Tmp
		<where>
			remark =0
			and isuse=0
			and FIND_IN_SET(#{pageObject.cuid},personnel)

			<if test="pageObject.level !=null">
				and level=#{pageObject.level}
			</if>
			<if test="pageObject.docNo !=null and pageObject.docNo !=''">
				and docNo like #{pageObject.docNo}
			</if>
			<if test="pageObject.docTitle !=null and pageObject.docTitle !=''">
				and docTitle like #{pageObject.docTitle}
			</if>
			<if test="pageObject.docSummary !=null and pageObject.docSummary !=''">
				and docSummary=#{pageObject.docSummary}
			</if>
			<if test="pageObject.signNum !=null">
				and signNum=#{pageObject.signNum}
			</if>
			<if test="pageObject.signStatus !=null">
				and signStatus=#{pageObject.signStatus}
			</if>
			<if test="pageObject.isuse !=null">
				and isuse=#{pageObject.isuse}
			</if>
			<if test="pageObject.name !=null and pageObject.name !=''  and pageObject.type == 2">
				and name like #{pageObject.name}
			</if>
			<if test="startTime !=null and startTime !=''">
				and createTime &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
			<if test="endTime !=null and endTime !=''">
				and createTime &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d
				%H:%i:%S')
			</if>
		</where>
	</select>
	
	
	<select id="getindexFirstGet" parameterType="String" resultType="DocMeet">
	SELECT id ,department, docNo ,docTitle, docSummary, (select o.name from sys_organization o join sys_user u on u.oid=o.id where u.id=d.cuid) as sendDepartmentInfo, 
createTime ,level ,null as name,null as meetTime,null as meetCompany,null as addr,1 as type,
(SELECT t.id from d_task t WHERE t.did=d.id and type=1 and t.oid=#{value}) as tid,(SELECT t.signStatus from d_task t WHERE t.did=d.id and type=1 and t.oid=#{value}) as signStatus
 from doc d where remark is null and isuse=0 and 
FIND_IN_SET(d.id,
(select GROUP_CONCAT(did) from d_task where signStatus=1 and remark is null and passRemark is null 
	and oid=#{value} and type=1))

UNION ALL

SELECT id, department, docNo, docTitle, docSummary, (select o.name from sys_organization o join sys_user u on u.oid=o.id where u.id=m.cuid) as sendDepartmentInfo,
 createTime , level, name ,meetTime ,(select name from
		sys_organization o where o.id=m.meetCompany) as
		meetCompany,addr,2 as type ,
(SELECT t.id from d_task t WHERE t.did=m.id and type=2 and t.oid=#{value}) as tid,(SELECT t.signStatus from d_task t WHERE t.did=m.id and type=2 and t.oid=#{value}) as signStatus
from meet m where remark is null and isuse=0 and 
FIND_IN_SET(m.id,
(select GROUP_CONCAT(did) from d_task where signStatus=1 and remark is null and passRemark is null 
	and oid=#{value} and type=2))

UNION ALL

SELECT id ,null as department ,null as docNo,title as docTitle,summary as docSummary,(select o.name from sys_organization o join sys_user u on u.oid=o.id where u.id=n.cuid) as sendDepartmentInfo,
 createTime,null as level,
null as name ,null as meetTime,null as meetCompany,null as addr ,3 as type ,
(SELECT t.id from d_task t WHERE t.did=n.id and type=3 and t.oid=#{value}) as tid,(SELECT t.signStatus from d_task t WHERE t.did=n.id and type=3 and t.oid=#{value}) as signStatus
from notice n  
where  isuse=0 and 
FIND_IN_SET(n.id,
(select GROUP_CONCAT(did) from d_task where signStatus=1 and remark is null and passRemark is null 
	and oid=#{value} and type=3))
	
	</select>



	<insert id="insert" parameterType="Meet">
		insert into
		meet(id,name,meetTime,meetCompany,department,level,docNo,docTitle,docSummary,contactName,contactPhone,addr,signNum,signStatus,passStatus,isuse,remark,cuid,createTime)
		values(#{id},#{name},#{meetTime},
		#{meetCompany},#{department,jdbcType=VARCHAR},#{level},#{docNo,jdbcType=VARCHAR},#{docTitle,jdbcType=VARCHAR},#{docSummary,jdbcType=VARCHAR},#{contactName,jdbcType=VARCHAR},#{contactPhone,jdbcType=VARCHAR},#{addr,jdbcType=VARCHAR},#{signNum},1,2,0,#{remark,jdbcType=VARCHAR},#{cuid},#{createTime})
	</insert>

	<insert id="copyInsert" parameterType="Meet">
		insert into
		meet(id,department,personnel,level,name,meetCompany,meetTime,docNo,docTitle,docSummary,contactName,contactPhone,addr,signNum,signStatus,isuse,remark,cuid,createTime,oldid,relayRemark)
		select
		#{id},department,#{personnel,jdbcType=VARCHAR},level,name,meetCompany,meetTime,docNo,docTitle,docSummary,contactName,contactPhone,addr,#{signNum},1,0,#{remark,jdbcType=VARCHAR},#{cuid},#{createTime},#{oldid},#{relayRemark}
		from meet where id=#{tid}
	</insert>

</mapper>