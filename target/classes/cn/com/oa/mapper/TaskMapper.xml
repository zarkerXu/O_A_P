<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.oa.mapper.TaskMapper">
	<resultMap id="Task" type="cn.com.oa.model.Task">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Nov 20 
			17:32:57 CST 2015. -->
		<id column="id" jdbcType="VARCHAR" property="id" />
		<result column="uid" jdbcType="VARCHAR" property="uid" />
		<result column="oid" jdbcType="VARCHAR" property="oid" />
		<result column="did" jdbcType="VARCHAR" property="did" />
		<result column="type" jdbcType="INTEGER" property="type" />
		<result column="signStatus" jdbcType="INTEGER" property="signStatus" />
		<result column="passStatus" jdbcType="INTEGER" property="passStatus" />
		<result column="remark" jdbcType="VARCHAR" property="remark" />
		<result column="passRemark" jdbcType="VARCHAR" property="passRemark" />
	</resultMap>



	<!-- 删除记录 -->
	<delete id="orgindelete" parameterType="String">
		delete from d_task where id = ${id}
	</delete>
	<delete id="delete" parameterType="String">
		delete from d_task where did in (${value}) and type=1
	</delete>
	<delete id="deletemt" parameterType="String">
		delete from d_task where did in (${value}) and type=2
	</delete>
	<delete id="deleteByPid" parameterType="String">
		delete from d_task where did = #{id}
	</delete>
	<select id="getDocRelayNum" parameterType="String" resultType="Integer">
		select count(*) from d_task where did=#{value} and type=1 and remark=0
	</select>
	<select id="getMeetRelayNum" parameterType="String" resultType="Integer">
		select count(*) from d_task where did=#{value} and type=2 and remark=0
	</select>
	<select id="select" parameterType="String" resultType="Task">
		select * from d_task where id=#{id}
	</select>
	<select id="findapproved" parameterType="Task" resultType="Task">
		select t.* ,u.name as uname ,o.name as organame from d_task t LEFT
		JOIN sys_user u ON t.uid=u.id LEFT JOIN sys_organization o ON
		t.oid=o.id where t.did=#{did} and type=#{type}
	</select>
	<select id="findcheckinfo" parameterType="String" resultType="Task">
		select t.*,o.name as organame,u.name as uname from d_task t LEFT JOIN
		sys_organization o on o.id=t.oid LEFT JOIN sys_user u on u.id =t.uid
		where t.did=#{did} order by t.signStatus desc,o.level,o.sort
	</select>
	<select id="findByParameter" parameterType="Task" resultType="Task">
		select * from d_task
		<where>
			<if test="uid !=null and uid !=''">
				and uid=#{uid}
			</if>
			<if test="type !=null">
				and type=#{type}
			</if>
			<if test="oid !=null and oid !=''">
				and oid=#{oid}
			</if>
			<if test="did !=null and did !=''">
				and did=#{did}
			</if>
			<if test="signStatus !=null">
				and signStatus=#{signStatus}
			</if>
			<if test="passStatus !=null">
				and passStatus=#{passStatus}
			</if>
			<if test="remark !=null and remark !=''">
				and remark=#{remark}
			</if>
			<if test="passRemark !=null and passRemark !=''">
				and passRemark=#{passRemark}
			</if>
		</where>
		<if test="orderBy !=null and orderBy !=''">
			order by ${orderBy}
		</if>
	</select>
	<select id="getIndexNum" parameterType="Task" resultType="Integer">
		select count(*) from d_task t where t.type=#{type}
		and (t.uid=#{uid} or (t.oid=(select oid from sys_user where id=#{uid})
		and t.uid is null and t.signStatus=1 and 0=(select ismain from
		sys_user where id=#{uid})))
		and signStatus=1 and remark is null
	</select>
	<update id="updatePassStatusByPid" parameterType="Task">
		update d_task set passStatus=#{passStatus} where did=#{did}
	</update>
	<update id="update" parameterType="Task">
		update d_task
		<set>
			<if test="uid !=null and uid !=''">
				uid=#{uid},
			</if>
			<if test="type !=null">
				type=#{type},
			</if>
			<if test="oid !=null and oid !=''">
				oid=#{oid},
			</if>
			<if test="did !=null and did !=''">
				did=#{did},
			</if>
			<if test="signStatus !=null">
				signStatus=#{signStatus},
			</if>
			<if test="passStatus !=null">
				passStatus=#{passStatus},
			</if>
			<if test="remark !=null and remark !=''">
				remark=#{remark},
			</if>
			<if test="passRemark !=null and passRemark !=''">
				passRemark=#{passRemark}
			</if>
		</set>
		where id=#{id}
	</update>
	<insert id="insert" parameterType="Task">
		insert into
		d_task(id,uid,oid,did,type,signStatus,passStatus,remark,passRemark)
		values(#{id},#{uid,jdbcType=VARCHAR},#{oid,jdbcType=VARCHAR},#{did,jdbcType=VARCHAR},#{type},1,3,#{remark},#{passRemark})
	</insert>
</mapper>